# 如何自定义服务启动命令

<span>Note:</span><div class="alertContent">![](../image/创建服务-启动命令.png)<br>在 [服务创建](http://support.c.163.com/wiki/md.html#!容器服务/服务管理/使用指南/创建无状态服务.md) 页面可以设置自定义启动命令，自定义启动命令会覆盖 Dockerfile 内默认的 CMD 命令。</div>

注意：

* 此处填写内容仅需输入 CMD 括号内内容，如命令 `CMD ["/usr/sbnin/sshd","-D"]` 仅需填写 `"/usr/sbnin/sshd","-D"`
* 添加自定义命令前，建议先了解 [CMD](https://docs.docker.com/engine/reference/builder/#cmd) 和 [ENTRYPOINT](https://docs.docker.com/engine/reference/builder/#entrypoint) 命令；
* 自定义命令不支持覆盖 ENTRYPOINT，鉴于此点如需添加自定义命令须了解原镜像的 CMD 和 ENTRYPOINT 内容；
* 请正确填写自定义命令，错误的自定义命令将导致服务创建失败。关于自定义命令请参考 [如何自定义服务启动命令](http://support.c.163.com/wiki/md.html#!容器服务/服务管理/使用指南/如何自定义服务启动命令.md)。


## 自定义命令说明
自定义命令相当于 kubernetes 的 [Args](http://kubernetes.io/docs/user-guide/containers/#containers-and-commands)，可以覆盖 CMD，但不会覆盖 ENTRYPOINT。规则举例如下：

| Image Entrypoint |  Image Cmd   |  自定义命令  |    最终结果    |
|------------------|--------------|--------------|----------------|
| [/ep-1]          | `<not set> ` | `<not set> ` | [ep-1]         |
| [/ep-1]          | `<not set> ` | [zoo boo]    | [ep-1 zoo bar] |
| [/ep-1]          | [foo bar]    | `<not set>`  | [ep-1 foo bar] |
| [/ep-1]          | [foo bar]    | [zoo boo]    | [ep-1 zoo boo] |
| `<not set> `     | [/ep-2]      | `<not set>`  | [ep-2]         |
| `<not set> `     | [/ep-2]      | [/ep-3]      | [ep-3]         |
| `<not set> `     | `<not set>`  | [/ep-3]      | [ep-3]         |

<span>Attention:</span><div class="alertContent">若不了解 CMD 和 ENTRYPOINT 命令，请阅读以下部分内容：</div>

## CMD 命令使用 

CMD 命令提供了容器默认执行的命令，即容器启动时默认允许的命令，可以理解为 Windows 系统下的开机启动项，每次启动容器时，CMD 指定的命令都会运行一次。CMD 命令只生效一次，多次使用时，只有最后一个生效。

CMD 命令共有三种格式，分别是：

* 用于 exec 执行可执行文件，并提供一个参数，建议使用此方法设置可执行文件：<pre>CMD ["可执行文件","参数1","参数2"]</pre>

* 用于为 ENTRYPOINT 指定参数：<pre>CMD ["参数1","参数2"]</pre>

* 用于以 /bin/sh -c 来执行命令，可能会产生无法控制的问题，不建议使用：
<pre>CMD 命令 参数1 参数2</pre>

## 常用自定义命令
* Nginx 镜像：<pre>CMD "nginx", "-g", "daemon off;"</pre>
* Apache 镜像：<pre>"httpd-foreground"</pre>
* Django 镜像：<pre>"python", "manage.py", "runserver", "0.0.0.0:8000"</pre>
* MySQL 镜像：<pre>"mysqld"</pre>
* NodeJS 镜像：<pre>"node"</pre>
* Rails 镜像：<pre>"rails", "server", "-b", "0.0.0.0"</pre>
* Redis 镜像：<pre>"redis-server"</pre>
* 当不确定镜像类型时，你可以选择使用如下命令：<pre>"/usr/sbin/sshd","-D"</pre>要求：镜像中已安装 sshd 服务。

## CMD 命令最佳实践 
<code>docker run</code> 命令中的参数都会传递给 <code>ENTRYPOINT</code> 指令，而不会被覆盖，当与 <code>CMD</code> 一同使用时，效果更好。 

通过 <code>ENTRYPOINT</code> 命令指定容器默认允许的文件如 <code>ENTRYPOINT ["/vhs/kangle/bin/kangle"]</code>，通过 <code>CMD</code> 来设置默认的参数 <code>CMD ["-S"]</code>。这样，当执行 <code>docker run -d imagesname</code> 时，就会在启动时自动执行 <code>/vhs/kangle/bin/kangle -S</code>。

当我们需要使用其他的参数时，只需要执行 <code>docker run -d imagesname --H</code>，在启动命令后加入新的参数 <code>--H</code>，就会自动执行 <code>--H</code> 参数，这时执行的命令就是 <code>/vhs/kangle/bin/kangle --H</code>。这种情况下，处理容器的交互问题就比较方便。