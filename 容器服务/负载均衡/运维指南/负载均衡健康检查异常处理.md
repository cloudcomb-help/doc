# 健康检查异常处理

请根据以下排查步骤中的指导逐条排查，详细记录排查测试结果：

1. 后端服务异常
#### 故障排查
查看后端对应服务状态是否为「运行中」。
#### 解决方案
确保服务正常运行。

2. 后端端口未开启
#### 故障排查
例如监听端口为 80 时，通过 `netstat -anp | grep 80` 查看是否开启了对应端口；<br>如果是七层负载均衡，通过 `curl -I 127.0.0.1` 查看返回的状态码是否和健康检查配置的正常状态码一致（默认为 2xx、3xx）。
#### 解决方案
请确保后端服务器开启了相应的端口（特别是未添加 CMD 或 ENTRYPOINT 启动命令的服务，重启或者重建后导致服务内应用未启动）。
3. 后端响应超时
#### 故障排查
查看后端业务本身响应的时间是否超出健康检查设置的响应超时时间（HTTP 默认 5000 ms，TCP 默认 2000 ms）。
#### 解决方案
查看后端服务负载，优化后端服务应用；提高健康检查设置中的「响应超时」时间（若响应时间远大于理想值，出于用户体验考虑，建议优化服务而不是提高响应超时时间）。

4. 租户私网异常
#### 故障排查
使用同一账号下其他服务内的容器，ping 健康检查失败的后端「内网 IP」，查看是否异常。
#### 解决方案
提交工单联系我们。

5. 安全策略
#### 故障排查
负载均衡会通过内网进行健康检查，这些访问来源都是负载均衡系统发起的。如果系统安全策略或安全软件屏蔽了负载均衡系统的内网 IP（租户内网）或监听端口，也将导致健康检查失败。
#### 解决方案
不要屏蔽租户自己的内网 IP（蜂巢私网是租户隔离的，安全无虞）、开放监听端口或临时关闭安全策略/软件（例如关闭 iptables `/etc/init.d/iptables stop`）。

6. 七层检测路径
#### 故障排查
七层服务健康检查指定的检测路径文件（默认 `/index.html`）设置为 php 等动态页面，或者路径文件不存在导致 404。
#### 解决方案
建议使用静态页面（也可以专门规划路径用于健康检查，只用于检查返回结果）并确保该文件可以被正常访问。

<span>Note:</span><div class="alertContent">若依然无法解决，[提交工单](https://c.163.com/dashboard#/m/ticket/create/?type=%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1)时请提供上述记录信息以便我们尽快协助你解决问题。</div>