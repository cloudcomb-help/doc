## 简介

负载均衡是对集群中的容器实例进行流量分发的服务。通过负载均衡功能，你可以扩展应用集群对外的服务能力，提高应用的可用性。

## 功能特点

* 会话保持
    * 负载均衡服务支持会话保持技术，在开启会话保持选项时，可以保证将请求转发到一个固定的后端服务副本上。
* 获取原始IP
    * NLB 在将请求转发给后端时，会将请求头插入 X-Forwarded-For 请求头，后端服务可以通过查询该 HTTP 头来获取原始 IP 地址。
*   支持X-Forwarded-Proto
    * 对于 HTTPS 的请求，在使用负载均衡进行证书托管的情况下，负载均衡会把协议填入 X-Forwarded-Proto 中，后端服务器可以通过该属性的值来判断请求的协议
*   支持主动健康检查
    * 在后端服务副本宕机时，会自动将对应节点从负载均衡的转发列表中移出，保证服务的高可用。
*   按域名和URL规则转发
    * 通过设定域名或URL的转发规则，可以将流量分发到不同的后端服务，让系统部署更加灵活。

## 优势

*   BGP网卡带宽，专线
	*   所有经过负载均衡的流量有独立的 BGP 外网入口，提供高性能，跨网络（电信，联通）的网络服务。
*   虚拟化层资源隔离
    *   不同负载均衡实例之间通过虚拟化技术实现了资源隔离，单个实例负载过高不会影响到其他实例。
*   高可用
    *   负载均衡实例在发生异常时，会自动重建，保证用户集群的可靠性。
*   可伸缩
    *   支持在线扩容，可以根据需求在线调整实例规格，在不影响服务的情况下实现集群的扩容/缩容。
*   平滑升级
    *   在系统升级时可以将需要升级的集群在转发列表中移除，实现平滑升级。

## 负载均衡策略

负载均衡策略支持 Session Sticky，即会话绑定，目前支持自动生成 cookie，并插入到用户的响应中，系统可以根据 cookie 内容将用户请求发送到后端固定的服务器上。

## 负载均衡服务可靠性

服务本身多点互备，通过 OSPF 实现高可用。内层通过健康检查进行互备，分布在两个不同的云计算域（系统独享）下，故障切换时间为快速。在保证多机房下的高可用，即使在部分服务宕机的情况下仍然可以保障服务。

本身管理服务与负载均衡服务分离，负载均衡服务和健康检查可以在管理服务宕机时独立运行，只是无法进行管理操作。管理服务高可用级别较低，在服务宕机或者升级时会导致管理服务不可用，但不会影响负载均衡服务。

## 负载均衡性能

单个最小实例、七层实例的极限负载能力是 5W QPS 左右，完全满足大部分的互联网业务需求，同时后台引入 Auto Scale 功能，会根据负载情况进行自动扩容/减容。

## 案例
*  网易新闻
*  网易云信
*  有道云笔记
*  中顺易金融云
*  网新云
