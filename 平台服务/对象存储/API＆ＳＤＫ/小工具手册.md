## Java环境

JDK 6 及以上版本

## 安装

将 nos-cmd-java-0.0.1.tar.gz解压到一个目录下，如:

    $ tar -zxvf nos-cmd-java-0.0.1.tar.gz
    $ cd nos-cmd-java-0.0.1/
    $ ls
    conf  lib  third-party  tool.bat  tool.sh
    $ chmod +x tool.sh(linux)

可以看到该目录包含如下文件和文件夹：conf lib logs third-party tool.bat tool.sh

## 修改配置文件

1. 添加 Accesskey 和 Secretkey：编辑 conf/credentials.properties，改成自己的 Accesskey 和 Secretkey 。

2. 修改 NOS 地址：编辑 conf/host.properties ，根据自己的需要修改 host 的值，即 NOS 的服务器地址（内网域名或者外网域名）, 一般情况无需修改。

## 使用 tool.sh

tool.sh 为你在 Linux 环境下的使用命令，tool.bat 为 Windows 环境下的使用命令，tool.sh 和 tool.bat 的使用方法一致，以下以 tool.sh 为例说明各功能点的使用方法

首次使用需要赋予 tool.sh 文件可执行权限：chmod +x tool.sh 

### 查看有些什么功能

    $ ./tool.sh

### 列出用户的所有桶
命令格式：command -listbuckets

举例:

    $ ./tool.sh -listbuckets
    Bucket Name:123
    Bucket Name:126
    1

当前用户有两个桶，分别为 123 和 126, 输出的 1 表示成功，其他表示请求失败，失败原因可以在 ./logs/ 目录下查看，若未特别说明，下同。

### 查看桶的acl属性
命令格式：command -getbucketacl <bucketname>

举例：

    ./tool.sh -getbucketacl 123
    bucket:123 acl:public-read
    1

获取桶 123 的 acl 属性，其属性为 public-read

### 设置桶的 acl 属性
命令格式：command -setbucketacl <bucketname> <acl>

举例：

    ./tool.sh -setbucketacl 123 private
    The acl of bucket:123 has changed to private
    1

设置桶 123 的 acl 属性，上面将桶 123 的 acl 属性设置为 private。设置为公开读则 acl 填 public-read

### 上传文件
命令格式：command -putfile <file> <bucketname> [-key <ObjectKey>] [-replace false(default)|true]

如果 file 是一个文件，则可以使用 -key 来指定存在 NOS 中的 ObjectKey , 如果不指定 -key，则 ObjectKey 为 file 的绝对路径。 如果 file 是一个目录，则会递归的将目录下的所有文件上传到 NOS ， ObjectKey 为 各级子目录.../文件名。 如果指定 -replace 的值为 true，则会覆盖桶内已经存在的同名文件, 如果为 false，则桶内如果已经存在同名文件，不会上传该文件。

举例：

    $ ./tool.sh -putfile a.txt 123 -key nosa.txt

将本地 a.txt 文件上传到 NOS，在 NOS 中的 ObjectKey 为 nosa.txt

    $ ./tool.sh -putfile a.txt 123

将本地 a.txt 文件上传到 NOS，在 NOS 中的 ObjectKey 为 a.txt 文件的绝对路径 /styx/home/hzzhenghuabin/nos-cmd-java-1.2.7/a.txt

    $ ./tool.sh -putfile conf 123 -replace true
    File:log4j.properties upload finished
    File:host.properties upload finished
    File:credentials.properties upload finished
    -----------------------------
    Finished files number:3
    Failed files number:0
    All files in directoryconf have upload finished.
    1

将本地 conf 文件夹下的文件上传到 NOS，成功上传 log4j.properties，host.properties，credentials.properties 三个文件到 NOS。

### 上传流和文件
命令格式：command -putstream <bucketname> <ObjectKey> [<file>]

指定了 <file> 上传文件，否则上传流。

举例：

    $ ./tool.sh  -putstream 123 haha.txt
    hello,world

输入内容如 hello,world 再按 Ctrl+D 结束流，即可将内容上传到桶 123 的 haha.txt 文件中

    $ ./tool.sh  -putstream 123 haha.txt conf/log4j.properties

将本地文件 conf/log4j.properties 上传到桶 123 的，存在 NOS 中的文件名为 haha.txt

### 查看桶或者文件是否存在
命令格式：command -lookup <bucketname> [<key>]

不指定<key>则查看桶是否存在，否则查看是否存在桶及桶是否存在某文件

举例：

    $ ./tool.sh -lookup 123
    1

查看是否存在桶 123，返回 1 表示存在，返回 -1 表示不存在或出现异常（可查看日志）。

    $ ./tool.sh -lookup 123 nosa.txt
    12

查看桶 123 是否存在文件 nosa.txt，如果存在，返回该文件的长度(>=0)，否则返回-1。

    $ ./tool.sh -lookup 123 nosa.txt2
    -1

桶 123 不存在文件 nosa.txt2

### 列出桶内文件列表
命令格式： command -listobjects <bucketname> [-prefix <prefix>] [-marker <marker>] [-maxkeys <maxkeys>]

指定 prefix、marker、maxkeys（都是可选）来列出文件列表， maxkeys 不指定时默认为100。

举例：

    $ ./tool.sh -listobjects 123 -maxkeys 2
    ObjectKey:1.jpg    Size:8855    LastModified:Mon Apr 25 16:59:37 CST 2016
    ObjectKey:1.mp3    Size:75448    LastModified:Tue Feb 11 17:55:57 CST 2014
    next marker: 1.mp3
    1

上例中一次性最多列出桶 123 内的 2 个文件，如果要列出下一页的 2 个文件，可以使用上次返回的 next marker 值（上例为1.mp3）作为本次的 marker 参数，如下：

    $ ./tool.sh -listobjects 123 -maxkeys 2 -marker 1.mp3
    ObjectKey:1.txt    Size:22226    LastModified:Fri Feb 21 15:15:12 CST 2014
    ObjectKey:error.gif    Size:730671    LastModified:Tue Mar 22 19:37:25 CST 2016
    next marker: error.gif
    1

### 下载文件
### 将桶内文件下载到本地文件夹
### 重命名对象
命令格式：command -moveobject <srcbuc> <srckey> <desbuc> <deskey>

当前 srcbuc 和 desbuc 必须一致，该命令将 srcbuc 桶内的 srckey 对象重命名为 deskey

举例：

    $ ./tool.sh -moveobject 123 nosa.txt 123 nosb.txt

将桶 123 的 nosa.txt 文件重命名为 noab.txt

### 复制对象
命令格式：command -copyobject <srcbucket> <srckey> <descbucket> <desckey>

举例：

    $ ./tool.sh -copyobject  123 nosb.txt 123 nosa.txt

将桶123的nosb.txt文件复制到桶123的nosa.txt文件

### 删除文件
命令格式：command -deleteobject <bucket> <key>

举例：

    $ ./tool.sh -deleteobject 123 nosb.txt

删除桶123中的nosb.txt对象