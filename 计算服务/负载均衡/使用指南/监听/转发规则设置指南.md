# 转发规则设置指南

## 1. 默认规则
默认转发所有请求。

* 1.1. 后端服务：
	* （面向服务）服务：后端服务 **必须** 添加该端口配置，详见 [常见问题 Q1](http://support.c.163.com/md.html#!计算服务/负载均衡/常见问题/负载均衡常见问题.md)；
	* （面向云主机）目标组：选择目标组详见 [管理目标组](http://support.c.163.com/md.html#!计算服务/负载均衡/使用指南/管理目标组-云主机.md)；
	* 健康检查：详见 [配置健康检查](http://support.c.163.com/md.html#!计算服务/负载均衡/运维指南/配置负载均衡健康检查.md)。
* 1.2. 会话保持
	* 可以选择「不启用」或「启用」，默认为「不启用」。启用会话保持可以「植入 Cookie」或「改写 Cookie」：
		* 植入 Cookie：负载均衡服务自动生成 Cookie，可以指定超时时间，单位为 S 默认 30 秒；
		* 改写 Cookie：改写用户指定的 Cookie，如果没有对应 Cookie 则不使用会话保持。

## 2. 定制规则

<span>Attention:</span><div class="alertContent">若请求匹配不到任意一条规则将返回 403；
若需要将未匹配的请求转发到后端，请添加一条域名为 * URL为 / 的通配规则。</div>

### 2.1. 域名

#### 2.1.1. 填写规则

支持字符串、通配符（前缀后缀匹配）、正则表达式：

* 不支持中文
* 多域名以空格分隔，不超过 512 个字符
* 单个域名内不支持空格
* 通配符 `*.` 必须在开头，`.*` 必须在结尾

		以 c.163.com 为例，格式如下所示：
		c.163.com 精确匹配 c.163.com 域名
		*.163.com 匹配所有以 163.com 结尾的域名
		c.163.* 匹配所有以 c.163 开始的域名

#### 2.1.2. 优先级

优先级从上往下：

* **字符串**
* 通配符
	* 通配符越靠前，优先级越高，如 `*.163.com` 高于 `c.163.*`
* 正则表达式
	* 长度越长，优先级越高
	* 长度相同，ASCII 码越大，优先级越高

### 2.2. URL 配置

#### 2.2.1. 填写规则

支持字符串、正则表达式：

* 字符串匹配需包含 `/`
* 不支持中文
* 多个 URL 以空格分隔，不超过128个字符
* 单个 URL 内不支持空格

#### 2.2.2. 优先级

优先级从上往下：

* **字符串**
* 正则表达式
	* 长度越长，优先级越高
	* 长度相同，ASCII 码越大，优先级越高

### 2.3. 健康检查

详见 [配置健康检查](../md.html#!计算服务/负载均衡/运维指南/配置负载均衡健康检查.md)。



